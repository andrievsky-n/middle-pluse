


# Шаблон для сборки проекта на основе Fractal

В основе этого сборщика лежит инструмент для создания стайл гайдов Fractal (http://fractal.build/).
Перед использованием обязательно изучаем документацию, читаем этот README и изучаем документацию используемого шаблонизатора Twig (http://x-twig.ru/for_template_designers/). В перспективе он может позволить теснее интегрировать сборку с бэком.


## Как пользоваться

**ТОЛЬКО ДЛЯ НОВЫХ ПРОЕКТОВ С НУЛЯ!**

* Разворачиваем проект, указывая [ИМЯ ПАПКИ ПРОЕКТА]:

npm
```
mkdir [ИМЯ ПАПКИ ПРОЕКТА] && cd [ИМЯ ПАПКИ ПРОЕКТА] && git clone git@gitlab.ddemo.ru:a.kosyanenko/fractal-boilerplate.git markup && cd markup && rm -rf .git && cd ../ && git init && git add -A && git commit -m 'init project' && cd markup && npm i
```

yarn
```
mkdir [ИМЯ ПАПКИ ПРОЕКТА] && cd [ИМЯ ПАПКИ ПРОЕКТА] && git clone git@gitlab.ddemo.ru:a.kosyanenko/fractal-boilerplate.git markup && cd markup && rm -rf .git && cd ../ && git init && git add -A && git commit -m 'init project' && cd markup && yarn install
```

Если не выйдет одним способом, используйте другой.

* Запустите дев режим с помощью команды `npm start` или `yarn start`


## Что включено в проект

* **Gulp** в качестве сборщика. Таски для галпа находятся в папке `internals/tasks`
* **Webpack** для сборки js
* Поддержка ES6
* Генерация svg symbols
* **Scss** в качестве css препроцессора
* **Twig** в качестве html препроцессора
* **Stylelint** для проверки scss кода
* **Eslint** для проверки js кода
* Минификация изображений, css и js кода при билде

## Структура проекта

```
├── markup/                                     # Исходники и конфиги
│   ├── src/                                    # Исходники
│   │   ├── components/                         # Компоненты
│   │   │   └── type/                           # Тип компонента (смотри раздел "Принципы работы — Компоненты")
│   │   │       └── component/                  # Папка компонента http://fractal.build/guide/components
│   │   │           ├── README.md               # Документация компонента
│   │   │           ├── component.conf.js       # Конфигурация компонента
│   │   │           ├── component.twig          # Разметка компонента
│   │   │           ├── component.js            # Скрипт компонента
│   │   │           └── component.scss          # Стили компонента
│   │   ├── docs/                               # Документация проекта http://fractal.build/guide/docs
│   │   ├── public/                             # Содержимое этой папки копируется в корень продакшн версии
│   │   │   └── assets                          # Здесь находятся все вспомогательные ресурсы проекта, такие как картинки, шрифты, файлы скриптов и стилей, которые мы хотим подключить отдельными файлами и т.д.
│   │   ├── scripts/                            # Скрипты
│   │   │   ├── vendor/                         # Сюда можно класть файлы библиотек и плагинов, которые мы можем затем подключить в main.js через import
│   │   │   └── main.js                         # Главный скрипт, используется как входная точка для подключения других скриптов
│   │   └── styles/                             # Стили
│   │       ├── vendor/                         # Сюда можно класть файлы библиотек и плагинов, которые мы можем затем подключить в main.scss через import.
│   │       ├── icons/                          # Генерируется автоматически. Туда добавляются стили с размерами иконок из svg спрайта
│   │       ├── common.scss                     # Сюда помещаем общие для проекта стили, например, для body, html, a и т.д.
│   │       ├── fonts.scss                      # Подключение шрифтов
│   │       ├── mixins.scss                     # Scss миксины и функции
│   │       ├── vars.scss                       # Scss переменные
│   │       └── main.scss                       # Главный стилевой файл
│   ├── dev/                                    # Сюда собирается проект в дев режиме (автогенерация)
│   ├── internals/                              # "Внутренности" сборщика
│   │   ├── generators/                         # Генераторы для команды "npm run generate" (https://plopjs.com/documentation/)
│   ├── themes/                                 # Кастомная тема для билда
│   ├── .babelrc                                # Настройки babel
│   ├── .browserlistrc                          # Список версий браузеров для Autoprefixer
│   ├── .editorconfig                           # Конфигурация настроек редактора кода
│   ├── .eslintignore                           # Список исключенных файлов и папок из eslint
│   ├── .eslintrc                               # Конфигурация проверки JavaScript в ESLint
│   ├── .gitignore                              # Список исключённых файлов из Git
│   ├── .postcssrc.js                           # Конфигурация PostCSS
│   ├── .stylelintignore                        # Список исключенных файлов и папок из stylelint
│   ├── .stylelintrc                            # Конфигурация проверки scss в Stylelint
│   ├── fractal.js                              # Конфигурация Fractal
│   ├── gulpfile.js                             # Файл для запуска Gulp.js
│   ├── package.json                            # Список модулей и прочей информации
│   ├── paths.js                                # Пути для конфигурационных файлов сборщика
│   ├── README.md                               # Документация шаблона
│   ├── webpack.config.js                       # Конфигурация Webpack.js
│   └── webpack-theme.config.js                 # Конфигурация Webpack.js темы fractal для билда
└── build/                                      # Сюда собирается проект после сборки (автогенерация)
```

## Принципы работы
### Компоненты
Компоненты поделены по принципам атомарного дизайна на 5 основных групп:
* atoms
* molecules
* organisms
* templates
* pages

Об этом разделении можно прочитать короткую статью https://habrahabr.ru/post/249223/

Внутри основных групп можно дополнительно группировать компоненты как угодно.

О том как использовать компоненты в fractal можно почитать в документации http://fractal.build/guide/components

Стили компонента подключаются автоматически.

Для подключения скриптов компонента в файл main.js можно использовать алиасы:
* `@atoms`
* `@molecules`
* `@organisms`
* `@templates`
* `@pages`

Т.е. вместо того, чтобы писать полный путь до компонента `../components/01-atoms/component-name/component-name` мы можем сократить до `@atoms/component-name/component-name`.

Создаем "атомы" и "молекулы", собираем из них "организмы" и страницы. При дублировании имен добавляем постфикс с первой буквой типа элемента (`-a`, `-m`, `-t`, `-p`). Например, имеем "организм" `comments`, который должен быть на соответствующей странице. Если нет возможности назвать страницу более уникально, называем ее `comments-p`.

Создаем компоненты через команду generate (`npm run generate` / `yarn generate`).

**Не делаем** огромные блоки "атомами". **Дробим** их на "молекулы" и "атомы".

* Для компонентов помимо имени и контекста задаем и статус — `wip` (Work in progress) или `ready`.

Всегда задаем базовый контекст компонентам и, по возможности, передаем его родительским компонентам (подробнее ниже).

### Контекст
Настройки и данные указываются в файле `/*.conf.js` компонента (не путать с `/*.config.json`);
можно указывать различные варианты контекста в свойстве `variants`:
```
variants: [
    {
        name: 'monsters',
        context: {
            class: 'img_monsters',
            imgSrc: '../../assets/images/img/monsters.svg',
            imgAlt: 'Корпорация монстров'
        }
    }
]
```
* Задаем переменные таким образом:
```
{% set pageClass = "page_index" %}
```

* Переменные передаются дочерним компонентам. К примеру, можно задать id страницы для дальнейшего указания активного пункта в меню.

Для удобства в глобальный контекст добавлены переменные:
* `jv0`  - эквивалент `javascript:void(0)`
* `assets` - заменяется на путь к папке assets


## Примечания и известные проблемы

1) При сохранении контекста (`*.conf.js`) данные в компоненте могут примениться не сразу, потребуется сохранить их повторно. Аналогичная проблема была в тарсе.

2) Передача контекста из дочернего компонента не происходит автоматически. 
Контекст дочернего компонента передается в родительский в виде свойства с названием компонента в качестве значения (https://fractal.build/guide/components/sub-components , вариант C): `imgLogo: '@img--logo'`;
подключение дочернего компонента с нужным контекстом происходит подобным образом (http://x-twig.ru/tags/include/):
```
{% include "@img" with imgLogo %}
```

*  Для переопределения отдельных свойств контекста можно использовать фильтр `merge` (http://x-twig.ru/filters/merge/):
```
{% set img = imgMonsters|merge({
    'class': 'logo__image'
})  %}
```

Но это может привести к ошибкам в случае, если элемент подключается в лэйаут, а не в саму страницу (`header`, `footer` и т.д.), и имя свойства лучше делать уникальным, поскольку мердж рекурсивный — например, свойство `class` может перезаписаться не только там, где надо, но и у вложенных элементов.

3) Если нужно задать динамическое имя тега, пишем так:
<!-- Нужно экранирование, а в обычном README.md — нет -->
```
<\{{tag}}> 
    \{{ text }}
</\{{tag}}>
```

## Список команд

Все команды запускаются через npm или yarn: `npm run имя_команды` или `yarn имя_команды`.

### start

Запускает дев режим с отслеживанием изменений, вносимых в код.

### build

Собирает продакшн версию проекта в папку `build`.

### start:t

Запуск дев режима с темой билда.

### generate

Позволяет в интерактивном режиме создать новый компонент.

### lint

Запустить проверку scss и js кода
